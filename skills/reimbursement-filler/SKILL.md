---
name: reimbursement-filler
description: 此技能用于自动化处理报销流程。它能从火车票和滴滴发票的汇总 Excel 文件中提取金额，自动填充到费用报销单模板中，并根据 PDF 附件数量自动计算并更新单据页数。
---

# 费用报销单自动填写技能 (Reimbursement Filler)

## 概述

该技能旨在简化财务报销流程。通过 Python 脚本自动化处理数据的汇总、模板填充以及附件统计，确保报销单金额准确且格式统一。

## 使用场景

- 批量处理出差报销：当已有火车票和滴滴发票的汇总表时，快速生成报销单。
- 自动附件统计：自动统计文件夹内的 PDF 数量，避免人工计数的错误。

## 核心流程

1. **金额提取与汇总**：
   - 从 `火车票提取结果_最新.xlsx` 提取 `price` 列（支持处理 `=金额` 格式的公式字符串）。
   - 从 `滴滴电子发票汇总.xlsx` 提取 `金额` 列。
   - 计算交通费总额。

2. **模板填充**：
   - 使用技能内置的 `assets/费用报销单模板.xlsx` 作为底稿。
   - 将总金额填入 `E5` 单元格（交通费）。
   - 将 `E6`（住宿费）和 `E7`（其他）清零或设为 0。
   - 自动更新 `D3` 单元格为当前填表日期。
   - 保留模板中原有的合计和金额大写公式。


3. **附件页数计算**：
   - 递归统计 `滴滴出行电子发票及行程报销单` 和 `火车票` 文件夹下的所有 `.pdf` 文件。
   - 总页数 = PDF 总数 + 2。
   - 将结果填入 `J3` 单元格，格式为 `单据及附件共X页`。

## 如何使用

### 运行脚本

在工作区根目录下执行以下脚本：

```bash
python .codebuddy/skills/reimbursement-filler/scripts/fill_reimbursement.py
```

执行完成后，将生成 `费用报销单.xlsx`。

## 依赖要求

- 必须存在 `费用报销单模板.xlsx`。
- 汇总数据文件：`火车票提取结果_最新.xlsx` 和 `滴滴电子发票汇总.xlsx`。
- 附件文件夹：`滴滴出行电子发票及行程报销单` 和 `火车票`。
- Python 库：`pandas`, `openpyxl`。
